@model E_Commerce_App.WebUI.ViewModels.OrderViewModel
@{ Layout = "_Layout";}

<div><br /><br /><br /></div>

@* sipariş başarılı sayfasına yönlendirme olsun. window.location.href *@
<form id="odeme-form" asp-controller="Order" asp-action="Checkout">
    <div class="row">
        <div class="col-md-12 mb-3">
            <div class="card p-5">
                Teslimat bilgileri
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <small>Ad</small>
                        <input class="form-control" asp-for="@Model.OrderDto.FirstName" placeholder="Teslim alacak kişinin adı" />
                    </div>
                    <div class="form-group col-md-3">
                        <small>Soyad</small>
                        <input class="form-control" asp-for="@Model.OrderDto.LastName" placeholder="Teslim alacak kişinin soyadı" />
                    </div>
                    <div class="form-group col-md-6">
                        <small>Telefon</small>
                        <input type="number" asp-for="@Model.OrderDto.Phone" max="10" min="10" class="form-control" placeholder="Teslim alacak kişinin telefon numarası" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <small>Şehir</small>
                        <select asp-for="@Model.OrderDto.City" id="il" class="form-control">
                            <option value="">Seçiniz...</option>
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <small>İlçe</small>
                        <select asp-for="@Model.OrderDto.District" id="ilce" class="form-control">
                            <option value="">Seçiniz...</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <small>Adres</small>
                    <textarea asp-for="@Model.OrderDto.Address" class="form-control" placeholder="Tam adres"></textarea>
                </div>
                <div class="form-group">
                    <small>Not</small>
                    <textarea asp-for="@Model.OrderDto.Note" class="form-control" placeholder="Not"></textarea>
                </div>
            </div>
        </div>
        <div class="col-md-12 mb-3">
            <div class="card p-5">
                Ödeme bilgileri
                <div class="row">
                    <div class="col-md-6 mt-1">
                        <div class="form-group">
                            <small>Kart numarası</small>
                            <input asp-for="@Model.CardNumber" class="form-control" placeholder="•••• •••• •••• ••••" id="number" />
                        </div>
                        <div class="form-group">
                            <small>Kart üzerindeki isim</small>
                            <input asp-for="@Model.CardName" class="form-control" id="name" placeholder="Kart sahibinin adı ve soyadı" />
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <small>Son kullanma tarihi</small>
                                <input type="hidden" asp-for="@Model.ExpirationYear" id="expiry-year" />
                                <input type="hidden" asp-for="@Model.ExpirationMonth" id="expiry-month" />
                                <input class="form-control" id="expiry" placeholder="Ay/Yıl" />
                            </div>
                            <div class="form-group col-md-6">
                                <small>Güvenlik kodu</small>
                                <input asp-for="@Model.Cvc" class="form-control" id="cvc" placeholder="CVC/CVV" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mt-4">
                        <div class="credit-card"></div>
                    </div>
                </div>

            </div>
        </div>
        <div class="col-md-12"><button class="btn btn-outline-dark btn-block">Ödemeyi Tamamla</button></div>
    </div>
</form>
@* dto yu required olarak etiketle *@
@section Css{
    <link href="~/node_modules/card/dist/jquery.card.css" />
}

@* Shadow card diye css stili olsun kesin. *@

@section Scripts{

    <script>
        $('#expiry').keyup(function () {
            var expiry = $("#expiry").val();

            var arr = expiry.split("/");


            $("#expiry-month").val(arr[0].trim());
            $("#expiry-year").val(arr[1].trim());

        });

    </script>
    @*<script src="~/node_modules/jquery-validation/dist/jquery.validate.min.js"></script>
        <script src="~/node_modules/jquery-validation/dist/additional-methods.min.js"></script>*@

    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/node_modules/card/dist/card.js"></script>

    <script>



        function myfunction() {

        }


        String.prototype.turkishToUpper = function () {
            var string = this;
            var letters = { "i": "İ", "ş": "Ş", "ğ": "Ğ", "ü": "Ü", "ö": "Ö", "ç": "Ç", "ı": "I" };
            string = string.replace(/(([iışğüçö]))+/g, function (letter) { return letters[letter]; })
            return string.toUpperCase();
        }

        String.prototype.turkishToLower = function () {
            var string = this;
            var letters = { "İ": "i", "I": "ı", "Ş": "ş", "Ğ": "ğ", "Ü": "ü", "Ö": "ö", "Ç": "ç" };
            string = string.replace(/(([İIŞĞÜÇÖ]))+/g, function (letter) { return letters[letter]; })
            return string.toLowerCase();
        }

        $.getJSON("/json/tr-iller-bolgeler.json", function (sonuc) {
            $.each(sonuc, function (index, value) {
                var row = "";
                var il = value.il.toUpperCase();
                console.log(value.il);
                row += '<option value="' + value.il + '">' + il + '</option>';
                $("#il").append(row);
            })
        });
        $("#il").on("change", function () {
            var il = $(this).val();
            console.log(il);
            $("#ilce").attr("disabled", false).html("<option value=''>Seçin..</option>");
            $.getJSON("/json/tr-iller-ilceler.json", function (sonuc) {
                $.each(sonuc, function (index, value) {
                    var row = "";
                    if (value.il == il) {
                        row += '<option value="' + value.ilce + '">' + value.ilce + '</option>';
                        $("#ilce").append(row);
                    }
                });
            });
        });
    </script>

    <script>


        $('#odeme-form').validate({
            rules: {
                "deneme": {
                    required: true,
                    minlength: 2,
                    maxlength: 50
                },
                "ProductDto.Price": {
                    required: true,
                },
            },
            messages: {
                "ProductDto.Name": {
                    required: "deneme",
                },
            },
            errorElement: 'span',
            errorPlacement: function (error, element) {
                error.addClass('invalid-feedback');
                element.closest('.form-group').append(error);
            },
            highlight: function (element, errorClass, validClass) {
                $(element).addClass('is-invalid');
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).removeClass('is-invalid');
            }
        });
    </script>

    <script>
        var card = new Card({
            form: '#odeme-form',
            container: '.credit-card',
            formSelectors: {
                numberInput: 'input#number',
                expiryInput: 'input#expiry',
                cvcInput: 'input#cvc',
                nameInput: 'input#name'
            },
            placeholders: {
                number: '•••• •••• •••• ••••',
                name: 'AD SOYAD',
                expiry: '••/••',
                cvc: '•••'
            }
        });
    </script>
}