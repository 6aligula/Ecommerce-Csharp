@model E_Commerce_App.WebUI.ViewModels.UserOrderViewModel
@{ Layout = "_Layout";
    var url = User.IsInRole("admin") ? "/Admin/Profile" : "my-profile";}
<br />
<br />
<br />
<br />
<div class="row">
    <div class="col-md-3" style="position: -webkit-sticky; position: sticky; top: 7em;">
        <ul class="list-group">
            <li class="list-group-item"><a href="@url">Profil</a></li>
            <li class="list-group-item active">Siparişlerim</li>
        </ul>
    </div>
    <div class="col-md-9">
        <div class="card card-primary">
            <div class="card-body">
                @if (Model.OrderItems.Count < 1)
                {
                    <div style="text-align:center;">
                        <i class="fas fa-shopping-cart icon" style="font-size:2em;"></i>
                        <h4>Henüz pazarda alışveriş yapmadınız.</h4>
                        <span>Alışveriş listesini <b>E-Pazar'ın</b> fırsatlarla dolu dünyasından doldurmak için aşağıdaki ürünleri incelemeye başlayabilirsin.</span>
                    </div>
                }
                else
                {
                    (List<OrderItemDto>, List<string>, List<RatingDto>) list = (Model.OrderItems, Model.OrderDates, Model.Ratings);

                    @foreach (var item in Model.OrderItems.Zip(Model.OrderDates, Tuple.Create).Zip(Model.Ratings, Tuple.Create))
                    {
                        var counter = 0;
                        var price = item.Item1.Item1.Price;
                        var orderState = item.Item1.Item1.Order.OrderState == EnumOrderState.Paid ? "Ödendi, kargoyu bekliyor."
                            : item.Item1.Item1.Order.OrderState == EnumOrderState.InShipping ? "Kargoya verildi."
                            : item.Item1.Item1.Order.OrderState == EnumOrderState.Cancelled ? "İptal edildi."
                            : item.Item1.Item1.Order.OrderState == EnumOrderState.Completed ? "Teslim edildi."
                            : "Sipariş Hatası";

                        <div class="p-2">
                            <div class="row">
                                <div class="col-md-3"><img src="/img/@item.Item1.Item1.Product.MainImage" width="100" height="100" /></div>
                                <div class="col-md-6">
                                    <h6>@item.Item1.Item1.Product.Name</h6>
                                    <h6><b>@(item.Item1.Item1.Quantity) Adet</b></h6>
                                    <h6><b>@(price * item.Item1.Item1.Quantity) TL</b></h6>
                                </div>
                                <div class="col-md-3">
                                    @* rating id yi buradaki modele ekle user order view modele yani gerci ordan ulasılabilir *@
                                    <p>@item.Item1.Item2</p>

                                    @{ var action = item.Item1.Item1.HasComment
                                                     ? Url.Action("CommentAddOrEdit", "Order", new { id = item.Item2.Id }, Context.Request.Scheme)
                                                     : Url.Action("CommentAddOrEdit", "Order", null, Context.Request.Scheme);}

                                    @if (item.Item1.Item1.HasComment)
                                    {
                                        <a onclick="showInPopupWithId(@item.Item1.Item1.Id, '@Url.Action("CommentAddOrEdit", "Order", new { id = item.Item2.Id }, Context.Request.Scheme)', 'Değerlendir')"
                                           class="btn btn-secondary text-white"><i class="fas fa-pencil-alt"></i> Değerlendir</a>
                                    }
                                    else
                                    {
                                        <a onclick="showInPopupWithId(@item.Item1.Item1.Id, '@Url.Action("CommentAddOrEdit", "Order", null, Context.Request.Scheme)','Değerlendir')"
                                           class="btn btn-success btn-block text-white"><i class="fas fa-plus-circle"></i> Değerlendir</a>
                                    }
                                    <hr />
                                    <p>@orderState</p>
                                </div>
                            </div>
                        </div>
                        <hr />
                    }
                }

            </div>
        </div>
    </div>
</div>
@section Css{
    <style>

        .icon {
            animation: MoveUpDown 2s linear infinite;
            position: relative;
            color: dodgerblue;
        }

        @@keyframes MoveUpDown {
            0%, 100% {
                bottom: 0;
            }

            50% {
                bottom: 20px;
            }
        }
    </style>
}